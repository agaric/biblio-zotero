<?php
class Zotero {
   static function getZoteroItemFields() {
      return array(
         'artwork:abstractNote',
         'artwork:accessDate',
         'artwork:archive',
         'artwork:archiveLocation',
         'artwork:artworkMedium',
         'artwork:artworkSize',
         'artwork:callNumber',
         'artwork:date',
         'artwork:extra',
         'artwork:language',
         'artwork:libraryCatalog',
         'artwork:rights',
         'artwork:shortTitle',
         'artwork:title',
         'artwork:url',
         'attachment:accessDate',
         'attachment:title',
         'attachment:url',
         'audioRecording:abstractNote',
         'audioRecording:accessDate',
         'audioRecording:archive',
         'audioRecording:archiveLocation',
         'audioRecording:audioRecordingFormat',
         'audioRecording:callNumber',
         'audioRecording:date',
         'audioRecording:extra',
         'audioRecording:ISBN',
         'audioRecording:label',
         'audioRecording:language',
         'audioRecording:libraryCatalog',
         'audioRecording:numberOfVolumes',
         'audioRecording:place',
         'audioRecording:rights',
         'audioRecording:runningTime',
         'audioRecording:seriesTitle',
         'audioRecording:shortTitle',
         'audioRecording:title',
         'audioRecording:url',
         'audioRecording:volume',
         'bill:abstractNote',
         'bill:accessDate',
         'bill:billNumber',
         'bill:code',
         'bill:codePages',
         'bill:codeVolume',
         'bill:date',
         'bill:extra',
         'bill:history',
         'bill:language',
         'bill:legislativeBody',
         'bill:rights',
         'bill:section',
         'bill:session',
         'bill:shortTitle',
         'bill:title',
         'bill:url',
         'blogPost:abstractNote',
         'blogPost:accessDate',
         'blogPost:blogTitle',
         'blogPost:date',
         'blogPost:extra',
         'blogPost:language',
         'blogPost:rights',
         'blogPost:shortTitle',
         'blogPost:title',
         'blogPost:url',
         'blogPost:websiteType',
         'book:abstractNote',
         'book:accessDate',
         'book:archive',
         'book:archiveLocation',
         'book:callNumber',
         'book:date',
         'book:edition',
         'book:extra',
         'book:ISBN',
         'book:language',
         'book:libraryCatalog',
         'book:numberOfVolumes',
         'book:numPages',
         'book:place',
         'book:publisher',
         'book:rights',
         'book:series',
         'book:seriesNumber',
         'book:shortTitle',
         'book:title',
         'book:url',
         'book:volume',
         'bookSection:abstractNote',
         'bookSection:accessDate',
         'bookSection:archive',
         'bookSection:archiveLocation',
         'bookSection:bookTitle',
         'bookSection:callNumber',
         'bookSection:date',
         'bookSection:edition',
         'bookSection:extra',
         'bookSection:ISBN',
         'bookSection:language',
         'bookSection:libraryCatalog',
         'bookSection:numberOfVolumes',
         'bookSection:pages',
         'bookSection:place',
         'bookSection:publisher',
         'bookSection:rights',
         'bookSection:series',
         'bookSection:seriesNumber',
         'bookSection:shortTitle',
         'bookSection:title',
         'bookSection:url',
         'bookSection:volume',
         'case:abstractNote',
         'case:accessDate',
         'case:caseName',
         'case:court',
         'case:dateDecided',
         'case:docketNumber',
         'case:extra',
         'case:firstPage',
         'case:history',
         'case:language',
         'case:reporter',
         'case:reporterVolume',
         'case:rights',
         'case:shortTitle',
         'case:url',
         'computerProgram:abstractNote',
         'computerProgram:accessDate',
         'computerProgram:archive',
         'computerProgram:archiveLocation',
         'computerProgram:callNumber',
         'computerProgram:company',
         'computerProgram:date',
         'computerProgram:extra',
         'computerProgram:ISBN',
         'computerProgram:libraryCatalog',
         'computerProgram:place',
         'computerProgram:programmingLanguage',
         'computerProgram:rights',
         'computerProgram:seriesTitle',
         'computerProgram:shortTitle',
         'computerProgram:system',
         'computerProgram:title',
         'computerProgram:url',
         'computerProgram:version',
         'conferencePaper:abstractNote',
         'conferencePaper:accessDate',
         'conferencePaper:archive',
         'conferencePaper:archiveLocation',
         'conferencePaper:callNumber',
         'conferencePaper:conferenceName',
         'conferencePaper:date',
         'conferencePaper:DOI',
         'conferencePaper:extra',
         'conferencePaper:ISBN',
         'conferencePaper:language',
         'conferencePaper:libraryCatalog',
         'conferencePaper:pages',
         'conferencePaper:place',
         'conferencePaper:proceedingsTitle',
         'conferencePaper:publisher',
         'conferencePaper:rights',
         'conferencePaper:series',
         'conferencePaper:shortTitle',
         'conferencePaper:title',
         'conferencePaper:url',
         'conferencePaper:volume',
         'dictionaryEntry:abstractNote',
         'dictionaryEntry:accessDate',
         'dictionaryEntry:archive',
         'dictionaryEntry:archiveLocation',
         'dictionaryEntry:callNumber',
         'dictionaryEntry:date',
         'dictionaryEntry:dictionaryTitle',
         'dictionaryEntry:edition',
         'dictionaryEntry:extra',
         'dictionaryEntry:ISBN',
         'dictionaryEntry:language',
         'dictionaryEntry:libraryCatalog',
         'dictionaryEntry:numberOfVolumes',
         'dictionaryEntry:pages',
         'dictionaryEntry:place',
         'dictionaryEntry:publisher',
         'dictionaryEntry:rights',
         'dictionaryEntry:series',
         'dictionaryEntry:seriesNumber',
         'dictionaryEntry:shortTitle',
         'dictionaryEntry:title',
         'dictionaryEntry:url',
         'dictionaryEntry:volume',
         'document:abstractNote',
         'document:accessDate',
         'document:archive',
         'document:archiveLocation',
         'document:callNumber',
         'document:date',
         'document:extra',
         'document:language',
         'document:libraryCatalog',
         'document:publisher',
         'document:rights',
         'document:shortTitle',
         'document:title',
         'document:url',
         'email:abstractNote',
         'email:accessDate',
         'email:date',
         'email:extra',
         'email:language',
         'email:rights',
         'email:shortTitle',
         'email:subject',
         'email:url',
         'encyclopediaArticle:abstractNote',
         'encyclopediaArticle:accessDate',
         'encyclopediaArticle:archive',
         'encyclopediaArticle:archiveLocation',
         'encyclopediaArticle:callNumber',
         'encyclopediaArticle:date',
         'encyclopediaArticle:edition',
         'encyclopediaArticle:encyclopediaTitle',
         'encyclopediaArticle:extra',
         'encyclopediaArticle:ISBN',
         'encyclopediaArticle:language',
         'encyclopediaArticle:libraryCatalog',
         'encyclopediaArticle:numberOfVolumes',
         'encyclopediaArticle:pages',
         'encyclopediaArticle:place',
         'encyclopediaArticle:publisher',
         'encyclopediaArticle:rights',
         'encyclopediaArticle:series',
         'encyclopediaArticle:seriesNumber',
         'encyclopediaArticle:shortTitle',
         'encyclopediaArticle:title',
         'encyclopediaArticle:url',
         'encyclopediaArticle:volume',
         'film:abstractNote',
         'film:accessDate',
         'film:archive',
         'film:archiveLocation',
         'film:callNumber',
         'film:date',
         'film:distributor',
         'film:extra',
         'film:genre',
         'film:language',
         'film:libraryCatalog',
         'film:rights',
         'film:runningTime',
         'film:shortTitle',
         'film:title',
         'film:url',
         'film:videoRecordingFormat',
         'forumPost:abstractNote',
         'forumPost:accessDate',
         'forumPost:date',
         'forumPost:extra',
         'forumPost:forumTitle',
         'forumPost:language',
         'forumPost:postType',
         'forumPost:rights',
         'forumPost:shortTitle',
         'forumPost:title',
         'forumPost:url',
         'hearing:abstractNote',
         'hearing:accessDate',
         'hearing:committee',
         'hearing:date',
         'hearing:documentNumber',
         'hearing:extra',
         'hearing:history',
         'hearing:language',
         'hearing:legislativeBody',
         'hearing:numberOfVolumes',
         'hearing:pages',
         'hearing:place',
         'hearing:publisher',
         'hearing:rights',
         'hearing:session',
         'hearing:shortTitle',
         'hearing:title',
         'hearing:url',
         'instantMessage:abstractNote',
         'instantMessage:accessDate',
         'instantMessage:date',
         'instantMessage:extra',
         'instantMessage:language',
         'instantMessage:rights',
         'instantMessage:shortTitle',
         'instantMessage:title',
         'instantMessage:url',
         'interview:abstractNote',
         'interview:accessDate',
         'interview:archive',
         'interview:archiveLocation',
         'interview:callNumber',
         'interview:date',
         'interview:extra',
         'interview:interviewMedium',
         'interview:language',
         'interview:libraryCatalog',
         'interview:rights',
         'interview:shortTitle',
         'interview:title',
         'interview:url',
         'journalArticle:abstractNote',
         'journalArticle:accessDate',
         'journalArticle:archive',
         'journalArticle:archiveLocation',
         'journalArticle:callNumber',
         'journalArticle:date',
         'journalArticle:DOI',
         'journalArticle:extra',
         'journalArticle:ISSN',
         'journalArticle:issue',
         'journalArticle:journalAbbreviation',
         'journalArticle:language',
         'journalArticle:libraryCatalog',
         'journalArticle:pages',
         'journalArticle:publicationTitle',
         'journalArticle:rights',
         'journalArticle:series',
         'journalArticle:seriesText',
         'journalArticle:seriesTitle',
         'journalArticle:shortTitle',
         'journalArticle:title',
         'journalArticle:url',
         'journalArticle:volume',
         'letter:abstractNote',
         'letter:accessDate',
         'letter:archive',
         'letter:archiveLocation',
         'letter:callNumber',
         'letter:date',
         'letter:extra',
         'letter:language',
         'letter:letterType',
         'letter:libraryCatalog',
         'letter:rights',
         'letter:shortTitle',
         'letter:title',
         'letter:url',
         'magazineArticle:abstractNote',
         'magazineArticle:accessDate',
         'magazineArticle:archive',
         'magazineArticle:archiveLocation',
         'magazineArticle:callNumber',
         'magazineArticle:date',
         'magazineArticle:extra',
         'magazineArticle:ISSN',
         'magazineArticle:issue',
         'magazineArticle:language',
         'magazineArticle:libraryCatalog',
         'magazineArticle:pages',
         'magazineArticle:publicationTitle',
         'magazineArticle:rights',
         'magazineArticle:shortTitle',
         'magazineArticle:title',
         'magazineArticle:url',
         'magazineArticle:volume',
         'manuscript:abstractNote',
         'manuscript:accessDate',
         'manuscript:archive',
         'manuscript:archiveLocation',
         'manuscript:callNumber',
         'manuscript:date',
         'manuscript:extra',
         'manuscript:language',
         'manuscript:libraryCatalog',
         'manuscript:manuscriptType',
         'manuscript:numPages',
         'manuscript:place',
         'manuscript:rights',
         'manuscript:shortTitle',
         'manuscript:title',
         'manuscript:url',
         'map:abstractNote',
         'map:accessDate',
         'map:archive',
         'map:archiveLocation',
         'map:callNumber',
         'map:date',
         'map:edition',
         'map:extra',
         'map:ISBN',
         'map:language',
         'map:libraryCatalog',
         'map:mapType',
         'map:place',
         'map:publisher',
         'map:rights',
         'map:scale',
         'map:seriesTitle',
         'map:shortTitle',
         'map:title',
         'map:url',
         'newspaperArticle:abstractNote',
         'newspaperArticle:accessDate',
         'newspaperArticle:archive',
         'newspaperArticle:archiveLocation',
         'newspaperArticle:callNumber',
         'newspaperArticle:date',
         'newspaperArticle:edition',
         'newspaperArticle:extra',
         'newspaperArticle:ISSN',
         'newspaperArticle:language',
         'newspaperArticle:libraryCatalog',
         'newspaperArticle:pages',
         'newspaperArticle:place',
         'newspaperArticle:publicationTitle',
         'newspaperArticle:rights',
         'newspaperArticle:section',
         'newspaperArticle:shortTitle',
         'newspaperArticle:title',
         'newspaperArticle:url',
         'patent:abstractNote',
         'patent:accessDate',
         'patent:applicationNumber',
         'patent:assignee',
         'patent:country',
         'patent:extra',
         'patent:filingDate',
         'patent:issueDate',
         'patent:issuingAuthority',
         'patent:language',
         'patent:legalStatus',
         'patent:pages',
         'patent:patentNumber',
         'patent:place',
         'patent:priorityNumbers',
         'patent:references',
         'patent:rights',
         'patent:shortTitle',
         'patent:title',
         'patent:url',
         'podcast:abstractNote',
         'podcast:accessDate',
         'podcast:audioFileType',
         'podcast:episodeNumber',
         'podcast:extra',
         'podcast:language',
         'podcast:rights',
         'podcast:runningTime',
         'podcast:seriesTitle',
         'podcast:shortTitle',
         'podcast:title',
         'podcast:url',
         'presentation:abstractNote',
         'presentation:accessDate',
         'presentation:date',
         'presentation:extra',
         'presentation:language',
         'presentation:meetingName',
         'presentation:place',
         'presentation:presentationType',
         'presentation:rights',
         'presentation:shortTitle',
         'presentation:title',
         'presentation:url',
         'radioBroadcast:abstractNote',
         'radioBroadcast:accessDate',
         'radioBroadcast:archive',
         'radioBroadcast:archiveLocation',
         'radioBroadcast:audioRecordingFormat',
         'radioBroadcast:callNumber',
         'radioBroadcast:date',
         'radioBroadcast:episodeNumber',
         'radioBroadcast:extra',
         'radioBroadcast:language',
         'radioBroadcast:libraryCatalog',
         'radioBroadcast:network',
         'radioBroadcast:place',
         'radioBroadcast:programTitle',
         'radioBroadcast:rights',
         'radioBroadcast:runningTime',
         'radioBroadcast:shortTitle',
         'radioBroadcast:title',
         'radioBroadcast:url',
         'report:abstractNote',
         'report:accessDate',
         'report:archive',
         'report:archiveLocation',
         'report:callNumber',
         'report:date',
         'report:extra',
         'report:institution',
         'report:language',
         'report:libraryCatalog',
         'report:pages',
         'report:place',
         'report:reportNumber',
         'report:reportType',
         'report:rights',
         'report:seriesTitle',
         'report:shortTitle',
         'report:title',
         'report:url',
         'statute:abstractNote',
         'statute:accessDate',
         'statute:code',
         'statute:codeNumber',
         'statute:dateEnacted',
         'statute:extra',
         'statute:history',
         'statute:language',
         'statute:nameOfAct',
         'statute:pages',
         'statute:publicLawNumber',
         'statute:rights',
         'statute:section',
         'statute:session',
         'statute:shortTitle',
         'statute:url',
         'thesis:abstractNote',
         'thesis:accessDate',
         'thesis:archive',
         'thesis:archiveLocation',
         'thesis:callNumber',
         'thesis:date',
         'thesis:extra',
         'thesis:language',
         'thesis:libraryCatalog',
         'thesis:numPages',
         'thesis:place',
         'thesis:rights',
         'thesis:shortTitle',
         'thesis:thesisType',
         'thesis:title',
         'thesis:university',
         'thesis:url',
         'tvBroadcast:abstractNote',
         'tvBroadcast:accessDate',
         'tvBroadcast:archive',
         'tvBroadcast:archiveLocation',
         'tvBroadcast:callNumber',
         'tvBroadcast:date',
         'tvBroadcast:episodeNumber',
         'tvBroadcast:extra',
         'tvBroadcast:language',
         'tvBroadcast:libraryCatalog',
         'tvBroadcast:network',
         'tvBroadcast:place',
         'tvBroadcast:programTitle',
         'tvBroadcast:rights',
         'tvBroadcast:runningTime',
         'tvBroadcast:shortTitle',
         'tvBroadcast:title',
         'tvBroadcast:url',
         'tvBroadcast:videoRecordingFormat',
         'videoRecording:abstractNote',
         'videoRecording:accessDate',
         'videoRecording:archive',
         'videoRecording:archiveLocation',
         'videoRecording:callNumber',
         'videoRecording:date',
         'videoRecording:extra',
         'videoRecording:ISBN',
         'videoRecording:language',
         'videoRecording:libraryCatalog',
         'videoRecording:numberOfVolumes',
         'videoRecording:place',
         'videoRecording:rights',
         'videoRecording:runningTime',
         'videoRecording:seriesTitle',
         'videoRecording:shortTitle',
         'videoRecording:studio',
         'videoRecording:title',
         'videoRecording:url',
         'videoRecording:videoRecordingFormat',
         'videoRecording:volume',
         'webpage:abstractNote',
         'webpage:accessDate',
         'webpage:date',
         'webpage:extra',
         'webpage:language',
         'webpage:rights',
         'webpage:shortTitle',
         'webpage:title',
         'webpage:url',
         'webpage:websiteTitle',
         'webpage:websiteType',
         );
   }
   
   static  function getZoteroItemCreatorTypes () {
      return array(
         'artwork:artist',
         'artwork:contributor',
         'audioRecording:composer',
         'audioRecording:contributor',
         'audioRecording:performer',
         'audioRecording:wordsBy',
         'bill:contributor',
         'bill:cosponsor',
         'bill:sponsor',
         'blogPost:author',
         'blogPost:commenter',
         'blogPost:contributor',
         'book:author',
         'book:contributor',
         'book:editor',
         'book:seriesEditor',
         'book:translator',
         'bookSection:author',
         'bookSection:bookAuthor',
         'bookSection:contributor',
         'bookSection:editor',
         'bookSection:seriesEditor',
         'bookSection:translator',
         'case:author',
         'case:contributor',
         'case:counsel',
         'computerProgram:contributor',
         'computerProgram:programmer',
         'conferencePaper:author',
         'conferencePaper:contributor',
         'conferencePaper:editor',
         'conferencePaper:seriesEditor',
         'conferencePaper:translator',
         'dictionaryEntry:author',
         'dictionaryEntry:contributor',
         'dictionaryEntry:editor',
         'dictionaryEntry:seriesEditor',
         'dictionaryEntry:translator',
         'document:author',
         'document:contributor',
         'document:editor',
         'document:reviewedAuthor',
         'document:translator',
         'email:author',
         'email:contributor',
         'email:recipient',
         'encyclopediaArticle:author',
         'encyclopediaArticle:contributor',
         'encyclopediaArticle:editor',
         'encyclopediaArticle:seriesEditor',
         'encyclopediaArticle:translator',
         'film:contributor',
         'film:director',
         'film:producer',
         'film:scriptwriter',
         'forumPost:author',
         'forumPost:contributor',
         'hearing:contributor',
         'instantMessage:author',
         'instantMessage:contributor',
         'instantMessage:recipient',
         'interview:contributor',
         'interview:interviewee',
         'interview:interviewer',
         'interview:translator',
         'journalArticle:author',
         'journalArticle:contributor',
         'journalArticle:editor',
         'journalArticle:reviewedAuthor',
         'journalArticle:translator',
         'letter:author',
         'letter:contributor',
         'letter:recipient',
         'magazineArticle:author',
         'magazineArticle:contributor',
         'magazineArticle:reviewedAuthor',
         'magazineArticle:translator',
         'manuscript:author',
         'manuscript:contributor',
         'manuscript:translator',
         'map:cartographer',
         'map:contributor',
         'map:seriesEditor',
         'newspaperArticle:author',
         'newspaperArticle:contributor',
         'newspaperArticle:reviewedAuthor',
         'newspaperArticle:translator',
         'patent:attorneyAgent',
         'patent:contributor',
         'patent:inventor',
         'podcast:contributor',
         'podcast:guest',
         'podcast:podcaster',
         'presentation:contributor',
         'presentation:presenter',
         'radioBroadcast:castMember',
         'radioBroadcast:contributor',
         'radioBroadcast:director',
         'radioBroadcast:guest',
         'radioBroadcast:producer',
         'radioBroadcast:scriptwriter',
         'report:author',
         'report:contributor',
         'report:seriesEditor',
         'report:translator',
         'statute:author',
         'statute:contributor',
         'thesis:author',
         'thesis:contributor',
         'tvBroadcast:castMember',
         'tvBroadcast:contributor',
         'tvBroadcast:director',
         'tvBroadcast:guest',
         'tvBroadcast:producer',
         'tvBroadcast:scriptwriter',
         'videoRecording:castMember',
         'videoRecording:contributor',
         'videoRecording:director',
         'videoRecording:producer',
         'videoRecording:scriptwriter',
         'webpage:author',
         'webpage:contributor',
         'webpage:translator',
         );
   }
   
   /**
   * @TODO send locale to zotero api
   **/
   static function getItemTypeStructure($refresh = FALSE ) {
      $type_fields = &drupal_static(__FUNCTION__);
      if (! isset ($type_fields) ) {
         $cache = cache_get('biblio_zotero__item_type_field_data');
         if ( $cache && ! $refresh ) {
            $type_fields = $cache->data;
         }
         else {
            $type_fields = array();
            $types = self::_getAllItemTypes();
            foreach ( $types  as $item_type) {
               $item_type->fields = self::_getItemTypeFields($item_type);
               $item_type->creators = self::_getItemTypeCreators($item_type);
               $type_fields[$item_type->itemType] = $item_type;
            }
            cache_set('biblio_zotero__item_type_field_data', $type_fields, 'cache');
         }
      }
      return $type_fields;
   }
   
   /**
   * @TODO send locale to zotero api
   * @TODO write a function to compare file-based sources with api-based itemType creators
   **/
/*    static function getAllItemTypeCreators($refresh = FALSE ) {
      $type_creators = &drupal_static(__FUNCTION__);
      if (! isset ($type_creators) ) {
         $cache = cache_get('biblio_zotero__item_type_creator_data');
         if ( $cache && ! $refresh ) {
            $type_creators = $cache->data;
         }
         else {
            $type_creators = array();
            $types = self::_getAllItemTypes();
            foreach ( $types  as $item_type) {
               $type_creators[$item_type->itemType] = $item_type;
            }
            cache_set('biblio_zotero__item_type_creator_data', $type_creators, 'cache');
         }
      }
      return $type_creators;
   }
 */   
   private function _getAllItemTypes() {
      $url = "https://api.zotero.org/itemTypes";
      $json = file_get_contents($url);
      $data = json_decode($json);
      return $data;
   }
   
   private function _getItemTypeFields($item_type) {
      $url = "https://api.zotero.org/itemTypeFields?itemType=$item_type->itemType";
      $json = file_get_contents($url);
      $data = json_decode($json);
      foreach ($data as $idx => $field) {
         $data[$field->field] = $field;
         unset($data[$idx]);
      }
      return $data;
   }

   private function _getItemTypeCreators($item_type) {
      $url = "https://api.zotero.org/itemTypeCreatorTypes?itemType=$item_type->itemType";
      $json = file_get_contents($url);
      $data = json_decode($json);
      foreach ($data as $idx => $field) {
         $data[$field->creatorType] = $field;
         unset($data[$idx]);
      }
      return $data;
   }
}
